<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Recast — Compact Click-Through (Realistic Catalog)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="dark light">
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"></noscript>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    window.tailwind || (window.__cdnWarn = true);
  </script>
  <link rel="preconnect" href="https://unpkg.com">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    window.addEventListener('error', function(){}, { once: true });
  </script>
</head>
<body class="min-h-screen bg-[#0b1020] text-slate-100 antialiased" style="font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji">
  <div id="app" class="min-h-screen"></div>

  <script>
    const STATE = {
      activeTab: 'problems',
      impact: { minutes: 9, pkgHours: 6, riskHrs: 0 },
      defaults: { impact: { minutes: 9, pkgHours: 6, riskHrs: 0 } },
      ctx: { device: 'Windows', network: 'Corporate', compliant: true },
      packHrs: 8, configHrs: 2, currentHrs: 24,
      roiInputs: { users: 5000, ticketsPerUserPerMonth: 0.035, avgHandleMins: 18, loadedCostPerHour: 85, recastAnnualCost: 120000 },
      copied: false,
      showLabels: false,
      cdnIssues: !!window.__cdnWarn
    };

    const TABS = [
      { id: 'problems', label: 'Current State', icon: 'alert-triangle' },
      { id: 'solution', label: 'Recast Approach', icon: 'workflow' },
      { id: 'roi', label: 'Impact & ROI', icon: 'bar-chart-3' }
    ];

    const CATALOG = [
      { id: 'row-sec', title: 'Security', apps: ['Defender', 'Chrome', 'Firefox', 'Zoom'] },
      { id: 'row-prod', title: 'Productivity', apps: ['Office', 'Teams', 'Notepad++', 'Slack'] },
      { id: 'row-eng', title: 'Engineering', apps: ['VS Code', 'Git', 'Node', 'Python'] },
      { id: 'row-line', title: 'Line-of-Business', apps: ['ERP', 'CRM', 'HR Suite'] }
    ];

    function cx(...a){ return a.filter(Boolean).join(' '); }
    function round(n){ return Math.round(n*100)/100; }
    function num(n){ return new Intl.NumberFormat().format(Math.round(n)); }
    function cleanNum(v){ v = Number(String(v).replace(/[^0-9.\-]/g,'')); return isFinite(v) ? v : 0; }
    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }
    function routeRecommendation(ctx){
      if(!ctx.compliant) return 'Web';
      if(ctx.device==='Windows' && ctx.network!=='Home') return 'Local';
      return 'VDI';
    }

    function render(){
      const root=document.getElementById('app');
      root.innerHTML = `
        <a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:left-3 focus:top-3 focus:rounded focus:bg-yellow-300 focus:px-3 focus:py-1 focus:text-slate-900">Skip to content</a>

        ${STATE.cdnIssues ? `
          <div role="alert" class="bg-amber-500 text-slate-900 px-4 py-2 text-sm">
            Tailwind failed to load from CDN. The page will display unstyled. Check your network or CDN blocking settings.
          </div>
        ` : ''}

        <header class="relative overflow-hidden">
          <div aria-hidden="true" class="absolute inset-0">
            <div class="absolute -top-40 -left-28 h-[420px] w-[420px] blur-[110px] rounded-full bg-gradient-to-br from-sky-500/25 via-indigo-500/20 to-fuchsia-500/30"></div>
            <div class="absolute -top-16 right-0 h-[280px] w-[280px] blur-[110px] rounded-full bg-gradient-to-br from-fuchsia-400/25 via-purple-500/20 to-sky-500/25"></div>
          </div>
          <div class="relative mx-auto max-w-6xl px-4 pt-8 pb-6">
            <h1 class="text-3xl sm:text-4xl font-extrabold leading-tight">
              <span class="text-white">Recast Software</span>
            </h1>
            <p class="mt-2 max-w-2xl text-slate-300">
              ${STATE.activeTab==='problems'
                ? 'Application deployment isn’t the problem. Doing it fast, consistently, and securely across the business is. — Microsoft MVP'
                : 'Recast works across SCCM, Intune, Citrix, VMware Workspace ONE, and more—making the tools you already use faster, smarter, and easier to manage'}
            </p>
          </div>
          <div class="relative mx-auto max-w-6xl px-4">
            <div role="tablist" aria-label="Demo sections" class="flex w-full flex-wrap gap-2 rounded-full bg-[#0b152f] p-1 ring-1 ring-white/10">
              ${TABS.map(t=>`
                <button type="button"
                        role="tab"
                        id="tab-${t.id}"
                        aria-controls="panel-${t.id}"
                        class="${cx('inline-flex items-center gap-2 rounded-full px-3.5 py-1.5 text-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-400 transition', STATE.activeTab===t.id ? 'bg-yellow-400 text-slate-900' : 'text-slate-200 hover:bg-white/5')}"
                        data-action="switch-tab" data-tab="${t.id}" aria-selected="${STATE.activeTab===t.id}">
                  <i data-lucide="${t.icon}" class="w-4 h-4"></i><span>${t.label}</span>
                </button>
              `).join('')}
            </div>
          </div>
        </header>

        <main id="main" class="mx-auto max-w-6xl px-4 pb-16" tabindex="-1">
          ${STATE.activeTab!=='problems' ? `
            <div class="mt-3 grid grid-cols-1 gap-3 sm:grid-cols-3">
              ${chip('Minutes saved (per user/per month)', String(STATE.impact.minutes), 'emerald')}
              ${chip('Packaging hours avoided', String(STATE.impact.pkgHours), 'sky')}
              ${chip('Zero-day window reduced (hrs)', String(round(STATE.impact.riskHrs)), 'yellow')}
            </div>` : ''
          }
          <section class="mt-5" aria-live="polite">${renderActivePanel()}</section>
        </main>

        <footer class="border-t border-white/10">
          <div class="mx-auto max-w-6xl px-4 py-6 text-sm text-slate-400 flex items-center justify-between">
            <span class="inline-flex items-center gap-1"><i data-lucide="badge-check" class="w-4 h-4"></i> Demo only — single-file HTML</span>
            <button type="button" data-action="copy-json" class="rounded-full border border-white/15 bg-white/10 px-3 py-1.5 hover:bg-white/20 text-slate-200 text-sm inline-flex items-center gap-2">
              <i data-lucide="${STATE.copied ? 'check' : 'clipboard'}" class="w-4 h-4"></i>
              <span>${STATE.copied ? 'Copied' : 'Copy impact JSON'}</span>
            </button>
          </div>
        </footer>
      `;
      if (window.lucide?.createIcons) { try { window.lucide.createIcons(); } catch {} }
      attachEvents();
      if (STATE.activeTab === 'solution') { buildFlow(); }
      if (STATE.activeTab === 'roi') { updateROIOutputs(); }
    }

    function chip(label,value,tone){
      const tones={emerald:'from-emerald-400/80 to-teal-400/80',sky:'from-sky-400/80 to-indigo-400/80',yellow:'from-yellow-300/90 to-amber-400/90'};
      return `
        <div class="rounded-2xl border border-white/10 bg-[#0c142b] p-3">
          <div class="text-[11px] text-slate-300">${label}</div>
          <div class="mt-1 inline-flex items-center gap-2 rounded-full bg-gradient-to-r px-2 py-0.5 text-slate-900 ${tones[tone]}">
            <i data-lucide="badge-check" class="w-4 h-4"></i><span class="text-sm font-semibold">${value}</span>
          </div>
        </div>
      `;
    }

    function renderActivePanel(){
      if (STATE.activeTab==='problems') return renderProblems();
      if (STATE.activeTab==='solution') return renderSolution();
      if (STATE.activeTab==='roi') return renderROI();
      return '';
    }

    function renderProblems(){
      const items=[
        {t:'Fragmented delivery',s:'Windows / Mac / VDI / Web — users guess the right way.',i:'layers'},
        {t:'Packaging backlog',s:'Rebuild per version; updates stall.',i:'boxes'},
        {t:'Zero-day exposure',s:'Patching takes days, not minutes.',i:'shield'},
        {t:'Slow upgrades',s:'Stuck to old images; change is slow.',i:'layout-grid'}
      ];
      return `
        <section id="panel-problems" role="tabpanel" aria-labelledby="tab-problems" class="space-y-3">
          <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4">
            ${items.map(p=>`
              <article class="rounded-2xl border border-white/10 bg-[#0c142b] p-4">
                <div class="flex items-center gap-2"><i data-lucide="${p.i}" class="w-5 h-5 text-sky-300"></i><h3 class="text-base font-semibold">${p.t}</h3></div>
                <p class="mt-1 text-sm text-slate-300">${p.s}</p>
              </article>
            `).join('')}
          </div>
          <p class="text-sm text-slate-300">Too many apps, too many updates — IT can’t keep up, leaving systems behind and security at risk.</p>
          <div class="grid grid-cols-1 gap-3 md:grid-cols-3">
            ${callout('alert-triangle','Why change',[
              'App delivery is siloed and slow.',
              'Manual work drains scarce IT time and talent.',
              'Every delay leaves the business more exposed to risk'
            ])}
            ${callout('clock-4','Why now',[
              'Updates never stop — apps and systems change every few weeks.',
              'Regulators and insurers demand proof of fast patching.',
              'Legacy platforms are hitting end-of-life — forcing costly upgrades.'
            ])}
            ${callout('sparkles','Why Recast',[
              'Deliver apps faster with one workspace across all devices.',
              'Configure once, deploy anywhere, patch automatically.',
              'Zero-day closed in hours, not days.'
            ],true)}
          </div>
        </section>
      `;
    }
    function callout(icon,label,bullets,cta=false){
      return `
        <div class="rounded-2xl border border-white/10 bg-[#0c142b] p-3">
          <div class="flex items-center gap-2 text-sm font-semibold"><i data-lucide="${icon}" class="w-4 h-4 text-amber-400"></i><span>${label}</span></div>
          <ul class="mt-1 list-disc pl-5 text-sm text-slate-300">${bullets.map(b=>`<li>${b}</li>`).join('')}</ul>
          ${cta?`<div class="mt-3 flex justify-end"><button type="button" data-action="advance" data-next="solution" class="rounded-full bg-[#e76a1f] px-3 py-1.5 text-sm font-semibold text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-400 inline-flex items-center gap-2"><i data-lucide="arrow-right" class="w-4 h-4"></i> How Recast solves it</button></div>`:''}
        </div>
      `;
    }

    function renderSolution(){
      const saved=Math.max(0, Number(STATE.packHrs)-Number(STATE.configHrs));
      const reduced=Math.max(0, Number(STATE.currentHrs)-1.5);
      const route=routeRecommendation(STATE.ctx);
      return `
        <section id="panel-solution" role="tabpanel" aria-labelledby="tab-solution" class="space-y-3">
          <div class="grid grid-cols-1 gap-3 lg:grid-cols-2">
            ${renderFlow()}
            <div class="flex flex-col gap-3">
              ${cardUpdateOnce(saved)}
              ${cardZeroDay(reduced)}
              ${cardOneIcon(route)}
            </div>
          </div>
        </section>
      `;
    }

    function pill(label,active,action,value){
      return `<button type="button" class="${cx('rounded-full px-3 py-1 border text-xs transition focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-400',active?'bg-yellow-400 text-slate-900 border-transparent':'bg-[#0a1124] text-slate-200 hover:bg-white/10 border-white/10')}" data-action="${action}" data-value="${String(value)}">${label}</button>`;
    }

    function cardOneIcon(route){
      return `
        <div class="rounded-2xl border border-white/10 bg-[#0c142b] p-4">
          <div class="flex items-center gap-2"><span aria-hidden="true">🖥️</span><h3 class="text-base font-semibold">Always the Right App, No Matter Where You Work.</h3></div>
          <p class="mt-1 text-sm text-slate-300">Smart Icons open apps the best way for each user—on Windows, macOS, Web, VPN, or VDI.</p>
          <div class="mt-2 grid grid-cols-3 gap-2 text-xs">
            ${['Windows','Mac'].map(d=>pill(d,STATE.ctx.device===d,'set-device',d)).join('')}
            ${['Corporate','VPN'].map(n=>pill(n,STATE.ctx.network===n,'set-network',n)).join('')}
            ${pill(STATE.ctx.compliant?'Compliant':'Non-compliant',STATE.ctx.compliant,'toggle-compliance','')}
          </div>
          <div class="mt-2 text-sm text-slate-300">Recommended route:</div>
          <div class="inline-flex items-center gap-2 rounded-full bg-yellow-400 px-3 py-1 text-slate-900 text-sm"><i data-lucide="check-circle-2" class="w-4 h-4"></i>${route}</div>
          <div class="mt-3"><button type="button" class="rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs hover:bg-white/20" data-action="add-impact" data-kind="minutes" data-value="2">Add to impact (+2 min saved per user)</button></div>
        </div>
      `;
    }
    function cardUpdateOnce(saved){
      return `
        <div class="rounded-2xl border border-white/10 bg-[#0c142b] p-4">
          <div class="flex items-center gap-2"><span aria-hidden="true">⚙️</span><h3 class="text-base font-semibold">Update Once, Deploy Everywhere</h3></div>
          <p class="mt-1 text-sm text-slate-300">Package one time; push to cloud, on-prem, or hybrid with rings.</p>
          <div class="rounded-xl border border-white/10 bg-[#0a1124] p-3 text-sm">
            <div class="flex items-center gap-2 font-medium"><i data-lucide="wand-2" class="w-4 h-4"></i> Critical app updates</div>
            <label class="mt-2 flex items-center gap-2 text-xs">
              <span class="text-slate-400">Hours/package</span>
              <input class="w-20 rounded bg-slate-950 px-2 py-1" value="${STATE.packHrs}" inputmode="decimal" data-action="set-pack-hrs" aria-label="Hours per package">
              <span>→</span>
              <input class="w-20 rounded bg-slate-950 px-2 py-1" value="${STATE.configHrs}" inputmode="decimal" data-action="set-config-hrs" aria-label="Hours to configure">
            </label>
            <div class="mt-2 flex items-center justify-between rounded bg-black/20 px-3 py-2"><span>${STATE.packHrs} → ${STATE.configHrs} hrs</span><strong>${saved} hrs saved</strong></div>
            <div class="mt-2 text-[12px] text-slate-300 flex flex-wrap gap-2">
              <span class="rounded-full bg-black/30 px-2 py-1">☁️ Cloud</span>
              <span class="rounded-full bg-black/30 px-2 py-1">🖥️ On-Prem</span>
              <span class="rounded-full bg-black/30 px-2 py-1">🔀 Hybrid</span>
            </div>
            <button type="button" class="mt-2 rounded-full bg-white px-3 py-1 text-xs font-semibold text-slate-900" data-action="add-impact" data-kind="pkgHours" data-value="${saved}">Add to impact</button>
          </div>
        </div>
      `;
    }
    function cardZeroDay(reduced){
      return `
        <div class="rounded-2xl border border-white/10 bg-[#0c142b] p-4">
          <div class="flex items-center gap-2"><span aria-hidden="true">🛡️</span><h3 class="text-base font-semibold">Zero-Day Patches in Hours</h3></div>
          <p class="mt-1 text-sm text-slate-300">Security fixes deploy in 1–2 hours instead of a full day (~90% faster).</p>
          <div class="rounded-xl border border-white/10 bg-[#0a1124] p-3 text-sm">
            <div class="flex items-center gap-2 font-medium"><i data-lucide="shield-check" class="w-4 h-4"></i> Zero-day rollout</div>
            <label class="mt-2 flex items-center gap-2 text-xs">
              <span class="text-slate-400">Current hrs</span>
              <input class="w-24 rounded bg-slate-950 px-2 py-1" value="${STATE.currentHrs}" inputmode="decimal" data-action="set-current-hrs" aria-label="Current time to deploy (hours)">
            </label>
            <div class="mt-2 flex items-center justify-between rounded bg-black/20 px-3 py-2"><span>${STATE.currentHrs} → 1.5 hrs</span><strong>${round(reduced)} hrs reduced</strong></div>
            <button type="button" class="mt-2 rounded-full bg-white px-3 py-1 text-xs font-semibold text-slate-900" data-action="add-impact" data-kind="riskHrs" data-value="${reduced}">Add to impact</button>
          </div>
        </div>
      `;
    }

    function renderFlow(){
      return `
        <div class="rounded-2xl border border-white/10 bg-[#0c142b] p-4">
          <div class="flex items-center justify-between gap-3">
            <div class="flex items-center gap-2">
              <div class="h-6 w-6 rounded-lg bg-gradient-to-br from-sky-500 via-indigo-500 to-fuchsia-500 grid place-items-center"><i data-lucide="boxes" class="h-3.5 w-3.5 text-white"></i></div>
              <div>
                <h3 class="text-base font-semibold">Application Workspace</h3>
                <div class="text-[12px] text-slate-400">Curated & secured catalog</div>
              </div>
            </div>
            <div class="flex items-center gap-2 text-[12px] text-slate-300">
              <button type="button" class="rounded-full border border-white/15 bg-white/10 px-2.5 py-1" data-action="toggle-labels">${STATE.showLabels?'Hide':'Show'} labels</button>
              <button type="button" data-action="start-flow" class="rounded-full bg-white px-2.5 py-1.5 text-[12px] font-semibold text-slate-900">Start</button>
              <button type="button" data-action="reset-flow" class="rounded-full border border-white/20 bg-white/10 px-2.5 py-1.5 text-[12px]">Reset</button>
            </div>
          </div>

          <div id="flowCard" class="mt-3 rounded-xl border border-white/10 bg-[#0a1124] p-3" role="region" aria-label="Animated flow">
            <div class="space-y-2">
              ${CATALOG.map(s=>`
                <div class="grid" style="grid-template-columns: 15ch 1fr; gap:.5rem; align-items:center">
                  <div class="uppercase text-[11px] tracking-wider text-slate-400">${s.title}</div>
                  <div id="${s.id}" class="flex flex-wrap gap-2"></div>
                </div>
              `).join('')}
            </div>

            <div id="flowHubFlash" class="mt-2 hidden text-amber-300 text-[12px] inline-flex items-center gap-1"><i data-lucide="bolt" class="h-4 w-4"></i><span>Update published</span></div>

            <div class="mt-3 grid grid-cols-3 gap-2" aria-hidden="true">
              ${['Existing Platforms','Staged Rings','Access & Policy'].map((lbl,i)=>`
                <div class="rounded-xl border border-white/10 bg-[#0a1124] p-2">
                  <div class="text-[12px] text-slate-300">${lbl}</div>
                  <div id="flowConn${String.fromCharCode(65+i)}" class="mt-1 grid grid-cols-10 gap-1.5"></div>
                  <div class="mt-1 h-1 w-full origin-left scale-x-0 rounded bg-gradient-to-r from-sky-400 via-indigo-400 to-fuchsia-400 transition-transform duration-700" style="transition-delay:${550 + 120*i}ms" data-flow="bar"></div>
                </div>
              `).join('')}
            </div>

            <div class="mt-3 grid grid-cols-3 gap-2" aria-hidden="true">
              ${['Business Unit','Subsidiary','Region'].map((lbl,i)=>`
                <div class="rounded-xl border border-white/10 bg-[#0a1124] p-2">
                  <div class="text-[12px] text-slate-300">${lbl}</div>
                  <div id="flowGrp${String.fromCharCode(65+i)}" class="mt-1 grid grid-cols-8 gap-1.5"></div>
                  <div class="mx-auto mt-1 h-16 w-1 origin-top scale-y-0 rounded bg-gradient-to-b from-amber-300 via-white to-amber-300 transition-transform duration-700" style="transition-delay:${1000 + 150*i}ms" data-flow="drop"></div>
                </div>
              `).join('')}
            </div>

            <div class="mt-3 grid grid-cols-3 gap-2" aria-hidden="true">
              ${['Windows & macOS','VDI / Web','Mobile'].map((lbl,i)=>`
                <div class="rounded-xl border border-white/10 bg-[#0a1124] p-2 text-center">
                  <i data-lucide="${['monitor-smartphone','laptop','smartphone'][i]}" class="h-5 w-5 text-slate-300"></i>
                  <div id="flowDev${String.fromCharCode(65+i)}" class="mt-1 grid grid-cols-6 gap-1.5"></div>
                  <div class="mt-1 text-[11px] text-slate-400">${lbl}</div>
                </div>
              `).join('')}
            </div>

            <div class="mt-3">
              <div id="endUserCard" class="rounded-xl border border-white/10 bg-[#0b1328] p-3">
                <div class="flex items-center gap-3">
                  <div id="endUserAvatar" class="h-9 w-9 rounded-full bg-rose-600/90 grid place-items-center font-semibold">U</div>
                  <div class="text-sm">
                    <div class="font-medium text-slate-200">End user</div>
                    <div class="text-slate-400">Apps on demand — no waiting, no tickets.</div>
                  </div>
                </div>
                <div class="mt-3 h-1 w-full origin-left scale-x-0 rounded bg-gradient-to-r from-sky-400 via-indigo-400 to-fuchsia-400 transition-transform duration-700" style="transition-delay:2100ms" data-flow="beam"></div>
                <div class="relative mt-2 rounded-lg border border-white/10 bg-[#0b1328] p-4">
                  <i data-lucide="laptop" class="h-5 w-5 opacity-80"></i>
                  <div id="endUserBadge" class="absolute right-2 top-2 grid h-5 w-5 place-items-center rounded bg-rose-500 text-black font-bold opacity-0 translate-y-[-6px] scale-90 transition-all duration-500">!</div>
                  <div class="mt-1 text-[11px] text-slate-400">Workspace launches the correct app instantly</div>
                </div>
              </div>
              <div id="flowSuccess" class="mt-2 hidden text-emerald-300 text-[13px] inline-flex items-center gap-1">
                <i data-lucide="check-circle-2" class="h-4 w-4"></i><span>Delivered to every device type</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderROI(){
      const i = STATE.roiInputs;
      const calc = computeROI();
      return `
        <section id="panel-roi" role="tabpanel" aria-labelledby="tab-roi" class="space-y-3">
          <div class="grid grid-cols-1 gap-3 lg:grid-cols-2">
            <div class="rounded-2xl border border-white/10 bg-[#0c142b] p-4">
              <div class="flex items-center gap-2 mb-2">
                <i data-lucide="calculator" class="w-5 h-5"></i>
                <h3 class="text-base font-semibold">Inputs</h3>
              </div>
              <form id="roiForm" class="grid grid-cols-2 gap-3" novalidate>
                ${roiInput('Users','users',i.users,'number','Total employees in scope')}
                ${roiInput('Tickets per user / month','ticketsPerUserPerMonth',i.ticketsPerUserPerMonth,'number','Average app/helpdesk tickets per user per month')}
                ${roiInput('Avg handle time (mins / ticket)','avgHandleMins',i.avgHandleMins,'number','Analyst time per ticket')}
                ${roiInput('Loaded cost ($/hr)','loadedCostPerHour',i.loadedCostPerHour,'number','Fully-loaded hourly cost')}
                ${roiInput('Recast annual cost ($)','recastAnnualCost',i.recastAnnualCost,'number','License + support')}
                <div class="col-span-2 flex items-center gap-2">
                  <button type="button" data-action="reset-impact" class="rounded-full border border-white/15 bg-white/10 px-3 py-1.5 hover:bg-white/20 text-sm">Reset impact</button>
                  <div class="text-xs text-slate-400">Impact set above feeds this ROI.</div>
                </div>
              </form>
            </div>

            <div class="rounded-2xl border border-white/10 bg-[#0c142b] p-4">
              <div class="flex items-center gap-2 mb-2">
                <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                <h3 class="text-base font-semibold">Results</h3>
              </div>

              <div class="grid grid-cols-2 gap-3">
                <div class="rounded-xl border border-white/10 bg-[#0a1124] p-3">
                  <div class="text-[12px] text-slate-400">End-user time saved / year</div>
                  <div id="outEndUser" class="mt-1 text-xl font-semibold">${calc.endUserHoursF}</div>
                  <div class="text-[12px] text-slate-400">${calc.endUserValueF}</div>
                </div>

                <div class="rounded-xl border border-white/10 bg-[#0a1124] p-3">
                  <div class="text-[12px] text-slate-400">Packaging hours avoided</div>
                  <div id="outPkgHrs" class="mt-1 text-xl font-semibold">${calc.pkgHoursF}</div>
                  <div class="text-[12px] text-slate-400">${calc.pkgValueF}</div>
                </div>

                <div class="rounded-xl border border-white/10 bg-[#0a1124] p-3">
                  <div class="text-[12px] text-slate-400">Security window reduced</div>
                  <div id="outRisk" class="mt-1 text-xl font-semibold">${round(STATE.impact.riskHrs)} hrs</div>
                  <div class="text-[12px] text-slate-400">Qualitative risk reduction</div>
                </div>

                <div class="rounded-xl border border-white/10 bg-[#0a1124] p-3">
                  <div class="text-[12px] text-slate-400">Annual net ROI</div>
                  <div id="outNet" class="mt-1 text-2xl font-extrabold ${calc.net>0?'text-emerald-300':'text-rose-300'}">${calc.netF}</div>
                  <div class="text-[12px] text-slate-400">Payback: ${calc.paybackText}</div>
                </div>
              </div>

              <div class="mt-3 rounded-lg border border-white/10 bg-[#0a1124] p-3">
                <div class="text-[12px] text-slate-400">Assumptions</div>
                <ul class="mt-1 list-disc pl-5 text-sm text-slate-300 space-y-1">
                  <li>Minutes saved is per user per month, applied to all users in scope.</li>
                  <li>Packaging hours avoided are direct engineering time savings.</li>
                  <li>Security window reduction is reported qualitatively.</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      `;
    }

    function roiInput(label,key,val,type,hint){
      return `
        <label class="flex flex-col gap-1">
          <span class="text-sm text-slate-200">${label}</span>
          <input type="${type}" inputmode="decimal" value="${val}" data-roi="${key}" class="rounded border border-white/10 bg-slate-950 px-3 py-2 text-slate-100" aria-describedby="${key}-hint">
          <span id="${key}-hint" class="text-[11px] text-slate-400">${hint}</span>
        </label>
      `;
    }

    function computeROI(){
      const i = STATE.roiInputs;
      const users = clamp(cleanNum(i.users), 0, 10_000_000);
      const minPerUserPerMonth = clamp(cleanNum(STATE.impact.minutes), 0, 10_000);
      const endUserHours = users * (minPerUserPerMonth/60) * 12;
      const loaded = clamp(cleanNum(i.loadedCostPerHour), 0, 10_000);
      const endUserValue = endUserHours * loaded * 0.2; // conservative 20% capture of end-user time into value
      const pkgHours = clamp(cleanNum(STATE.impact.pkgHours), 0, 1_000_000);
      const pkgValue = pkgHours * loaded;
      const gross = endUserValue + pkgValue;
      const cost = clamp(cleanNum(i.recastAnnualCost), 0, 100_000_000);
      const net = gross - cost;
      const paybackMonths = gross>0 ? Math.max(0, Math.ceil((cost / Math.max(1, gross)) * 12)) : '—';
      return {
        endUserHours, endUserValue, pkgHours, pkgValue, net,
        endUserHoursF: `${num(endUserHours)} hrs`,
        endUserValueF: `$${num(endUserValue)}/yr`,
        pkgHoursF: `${num(pkgHours)} hrs`,
        pkgValueF: `$${num(pkgValue)}/yr`,
        netF: `$${num(net)}/yr`,
        paybackText: typeof paybackMonths==='number' ? `${paybackMonths} mo` : 'n/a'
      };
    }

    function updateROIOutputs(){
      const calc = computeROI();
      const el = (id)=>document.getElementById(id);
      if (el('outEndUser')) el('outEndUser').textContent = calc.endUserHoursF;
      if (el('outPkgHrs')) el('outPkgHrs').textContent = calc.pkgHoursF;
      if (el('outNet')) el('outNet').textContent = calc.netF;
      if (window.lucide?.createIcons) { try { window.lucide.createIcons(); } catch {} }
    }

    function buildFlow(){
      const dot = ()=> {
        const d = document.createElement('div');
        d.className = 'h-2 w-2 rounded bg-slate-600 opacity-90';
        return d;
      };
      const fillTiles = (id, count)=> {
        const host = document.getElementById(id);
        if (!host) return;
        host.innerHTML = '';
        for (let i=0;i<count;i++){ host.appendChild(dot()); }
      };
      CATALOG.forEach((row, idx)=>{
        const host = document.getElementById(row.id);
        if (!host) return;
        host.innerHTML = '';
        row.apps.forEach((name,i)=>{
          const b = document.createElement('div');
          b.className = 'flex items-center gap-2 rounded-lg border border-white/10 bg-[#0a1226] px-2 py-1';
          b.innerHTML = `
            <span class="grid h-8 w-8 place-items-center rounded-full bg-[#0a1226] ring-1 ring-white/15">
              <i data-lucide="app-window" class="w-4 h-4"></i>
            </span>
            <span class="text-xs text-slate-300 ${STATE.showLabels?'':'sr-only'}">${name}</span>
          `;
          host.appendChild(b);
        });
      });

      ['A','B','C'].forEach((k, i)=>{
        fillTiles(`flowConn${k}`, 10);
        fillTiles(`flowGrp${k}`, 8);
        fillTiles(`flowDev${k}`, 6);
      });

      const bars = Array.from(document.querySelectorAll('[data-flow="bar"]'));
      const drops = Array.from(document.querySelectorAll('[data-flow="drop"]'));
      const beam = document.querySelector('[data-flow="beam"]');
      const badge = document.getElementById('endUserBadge');
      const avatar = document.getElementById('endUserAvatar');
      const success = document.getElementById('flowSuccess');
      const flash = document.getElementById('flowHubFlash');

      const run = ()=>{
        flash.classList.remove('hidden');
        setTimeout(()=>flash.classList.add('hidden'), 900);

        bars.forEach((el, idx)=> {
          setTimeout(()=>{ el.style.transform = 'scaleX(1)'; }, 50 + idx*100);
        });
        drops.forEach((el, idx)=> {
          setTimeout(()=>{ el.style.transform = 'scaleY(1)'; }, 600 + idx*120);
        });
        setTimeout(()=>{
          if (beam){ beam.style.transform = 'scaleX(1)'; }
        }, 2100);
        setTimeout(()=>{
          if (badge){
            badge.style.opacity = '1';
            badge.style.transform = 'translateY(0) scale(1)';
            badge.textContent = '✓';
            badge.classList.remove('bg-rose-500');
            badge.classList.add('bg-emerald-400');
          }
          if (avatar){
            avatar.classList.remove('bg-rose-600/90');
            avatar.classList.add('bg-emerald-600/90');
          }
          if (success){ success.classList.remove('hidden'); }
        }, 2500);
      };
      run();
      if (window.lucide?.createIcons) { try { window.lucide.createIcons(); } catch {} }
    }

    function attachEvents(){
      document.querySelectorAll('[data-action="switch-tab"]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const tab = e.currentTarget.getAttribute('data-tab');
          STATE.activeTab = tab;
          render();
        });
      });

      const main = document.getElementById('main');

      main.addEventListener('click', (e)=>{
        const a = e.target.closest('[data-action]');
        if(!a) return;
        const action = a.getAttribute('data-action');

        if (action === 'advance'){
          const next = a.getAttribute('data-next') || 'solution';
          STATE.activeTab = next;
          render();
        }

        if (action === 'toggle-labels'){
          STATE.showLabels = !STATE.showLabels;
          render();
        }

        if (action === 'start-flow'){
          buildFlow();
        }

        if (action === 'reset-flow'){
          render();
        }

        if (action === 'add-impact'){
          const kind = a.getAttribute('data-kind');
          const val = cleanNum(a.getAttribute('data-value'));
          if (kind && !Number.isNaN(val)){
            if (kind === 'minutes') STATE.impact.minutes = round(STATE.impact.minutes + val);
            if (kind === 'pkgHours') STATE.impact.pkgHours = round(STATE.impact.pkgHours + val);
            if (kind === 'riskHrs') STATE.impact.riskHrs = round(STATE.impact.riskHrs + val);
            render();
          }
        }

        if (action === 'set-device'){
          STATE.ctx.device = a.getAttribute('data-value') || 'Windows';
          render();
        }

        if (action === 'set-network'){
          STATE.ctx.network = a.getAttribute('data-value') || 'Corporate';
          render();
        }

        if (action === 'toggle-compliance'){
          STATE.ctx.compliant = !STATE.ctx.compliant;
          render();
        }

        if (action === 'copy-json'){
          const payload = {
            impact: STATE.impact,
            context: STATE.ctx,
            roiInputs: STATE.roiInputs
          };
          try{
            navigator.clipboard.writeText(JSON.stringify(payload, null, 2)).then(()=>{
              STATE.copied = true;
              render();
              setTimeout(()=>{ STATE.copied = false; render(); }, 1200);
            }).catch(()=>{
              alert('Clipboard copy failed. Select and copy manually:\n\n' + JSON.stringify(payload, null, 2));
            });
          }catch(err){
            alert('Clipboard not available. Select and copy manually:\n\n' + JSON.stringify(payload, null, 2));
          }
        }

        if (action === 'reset-impact'){
          STATE.impact = JSON.parse(JSON.stringify(STATE.defaults.impact));
          render();
        }
      });

      main.addEventListener('input', (e)=>{
        const t = e.target;
        if (t.matches('[data-action="set-pack-hrs"]')){
          STATE.packHrs = clamp(cleanNum(t.value), 0, 1000);
        }
        if (t.matches('[data-action="set-config-hrs"]')){
          STATE.configHrs = clamp(cleanNum(t.value), 0, 1000);
        }
        if (t.matches('[data-action="set-current-hrs"]')){
          STATE.currentHrs = clamp(cleanNum(t.value), 0, 1000);
        }
        if (t.matches('[data-roi]')){
          const key = t.getAttribute('data-roi');
          const val = cleanNum(t.value);
          STATE.roiInputs[key] = val;
          updateROIOutputs();
        }
      });
    }

    document.addEventListener('DOMContentLoaded', render);
  </script>
</body>
</html>
